<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Fetcher</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' rx='6' fill='%231e293b'/%3E%3Cpolyline points='4,24 10,18 16,20 22,10 28,6' fill='none' stroke='%2322c55e' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'/%3E%3Ccircle cx='28' cy='6' r='2.5' fill='%2322c55e'/%3E%3C/svg%3E">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <style>
        .loading { opacity: 0.5; pointer-events: none; }
        .table-container { max-height: 500px; overflow-y: auto; }
        .sticky-header th { position: sticky; top: 0; background: #1f2937; z-index: 10; }
        /* Ensure chart has minimum height on mobile */
        @media (max-width: 768px) {
            .chart-section canvas { min-height: 250px; }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-blue-400">ðŸ“ˆ Stock Fetcher</h1>
            <p class="text-gray-400 mt-2">Fetch historical stock data with P/E ratio</p>
        </header>

        <!-- Search Form -->
        <div class="bg-gray-800 rounded-lg p-6 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <!-- Symbol Input -->
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Symbol</label>
                    <input type="text" id="symbol" placeholder="AAPL, MSFT, 0700.HK"
                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400"
                        value="AAPL">
                </div>

                <!-- Days Input -->
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Days</label>
                    <input type="number" id="days" min="1" max="10000"
                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white"
                        value="1825">
                </div>

                <!-- Period Select -->
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Period</label>
                    <select id="period"
                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white">
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly" selected>Monthly</option>
                        <option value="quarterly">Quarterly</option>
                        <option value="yearly">Yearly</option>
                    </select>
                </div>

                <!-- Fetch Button -->
                <div class="flex items-end">
                    <button id="fetchBtn" onclick="fetchStock()"
                        class="w-full px-6 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg font-medium transition-colors">
                        Fetch Data
                    </button>
                </div>
            </div>

            <!-- Quick Links -->
            <div class="mt-4 flex flex-wrap gap-2">
                <span class="text-gray-400 text-sm">Quick:</span>
                <button onclick="quickFetch('AAPL')" class="text-sm text-blue-400 hover:text-blue-300">AAPL</button>
                <button onclick="quickFetch('MSFT')" class="text-sm text-blue-400 hover:text-blue-300">MSFT</button>
                <button onclick="quickFetch('GOOGL')" class="text-sm text-blue-400 hover:text-blue-300">GOOGL</button>
                <button onclick="quickFetch('NVDA')" class="text-sm text-blue-400 hover:text-blue-300">NVDA</button>
                <button onclick="quickFetch('TSLA')" class="text-sm text-blue-400 hover:text-blue-300">TSLA</button>
                <button onclick="quickFetch('0700.HK')" class="text-sm text-blue-400 hover:text-blue-300">0700.HK</button>
                <button onclick="quickFetch('VOO')" class="text-sm text-blue-400 hover:text-blue-300">VOO</button>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loading" class="hidden text-center py-8">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-blue-500 border-t-transparent"></div>
            <p class="mt-2 text-gray-400">Fetching data...</p>
        </div>

        <!-- Error Message -->
        <div id="error" class="hidden bg-red-900/50 border border-red-500 rounded-lg p-4 mb-8">
            <p class="text-red-300" id="errorMsg"></p>
        </div>

        <!-- Results Section -->
        <div id="results" class="hidden">
            <!-- Stock Info -->
            <div class="bg-gray-800 rounded-lg p-6 mb-6">
                <div class="flex flex-wrap justify-between items-start gap-4">
                    <div>
                        <h2 class="text-2xl font-bold" id="companyName">-</h2>
                        <p class="text-gray-400">
                            <span id="stockSymbol">-</span> Â· 
                            <span id="dataSource" class="text-xs bg-gray-700 px-2 py-1 rounded">-</span>
                        </p>
                    </div>
                    <div class="text-right">
                        <p class="text-gray-400 text-sm">Records: <span id="recordCount" class="text-white">-</span></p>
                        <p class="text-gray-400 text-sm" id="epsContainer">TTM EPS: <span id="ttmEps" class="text-white">-</span></p>
                    </div>
                </div>
            </div>

            <!-- Chart -->
            <div id="chartSection" class="chart-section bg-gray-800 rounded-lg p-6 mb-6">
                <canvas id="priceChart" height="300"></canvas>
            </div>

            <!-- Export Buttons -->
            <div class="flex gap-4 mb-6">
                <button onclick="exportCSV()" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-sm font-medium transition-colors">
                    ðŸ“¥ Export CSV
                </button>
                <button onclick="exportJSON()" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-sm font-medium transition-colors">
                    ðŸ“¥ Export JSON
                </button>
                <button onclick="exportExcel()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm font-medium transition-colors">
                    ðŸ“¥ Export Excel
                </button>
            </div>

            <!-- Data Table -->
            <div class="bg-gray-800 rounded-lg overflow-hidden">
                <div class="table-container">
                    <table class="w-full text-sm">
                        <thead class="sticky-header">
                            <tr id="tableHeader" class="text-left text-gray-300">
                                <!-- Dynamic headers -->
                            </tr>
                        </thead>
                        <tbody id="tableBody" class="divide-y divide-gray-700">
                            <!-- Dynamic rows -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Indices Section -->
        <div class="mt-12">
            <h3 class="text-xl font-bold mb-4 text-gray-300">ðŸ“Š Available Indices</h3>
            <div id="indices" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <!-- Dynamic indices cards -->
            </div>
            
            <!-- Index Symbols Table (shown when an index is selected) -->
            <div id="indexSymbolsSection" class="hidden">
                <div class="bg-gray-800 rounded-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h4 id="indexSymbolsTitle" class="text-lg font-bold text-blue-400"></h4>
                        <button onclick="hideIndexSymbols()" class="text-gray-400 hover:text-white text-sm">âœ• Close</button>
                    </div>
                    <p id="indexSymbolsDesc" class="text-sm text-gray-400 mb-4"></p>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="text-left text-gray-400 border-b border-gray-700">
                                    <th class="py-2 px-2 w-12">#</th>
                                    <th class="py-2 px-2 w-24">Symbol</th>
                                    <th class="py-2 px-2">Company Name</th>
                                </tr>
                            </thead>
                            <tbody id="indexSymbolsBody" class="text-gray-300">
                                <!-- Dynamic symbols -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
